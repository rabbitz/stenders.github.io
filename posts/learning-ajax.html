<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <link rel="stylesheet" href="/css/font-awesome.min.css" />
  <link rel="stylesheet" href="/css/default.css" />
  <link rel="stylesheet" href="/css/index.css" />
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
  <nav class="container">
    <ul class="nav nav-pills pull-right">
      <li class="active"><a href="/">Home</a></li>
      <!-- <li><a href="./resume.html">About</a></li> -->
    </ul>
    <h3 class="text-muted"><a href="/">砸牛顿的大苹果</a></h3>
  </nav>
</header>
<div class="container">
  <div class="row marketing">
    <h2><a href="javascript:location.reload();">Ajax初探</a></h2>

<p>从事前端开发已经两年多，从来没学习和使用过Ajax（此时已经羞愧万分）。有则只是从jQuery中了解过封装的方法，但是因为没有接触后端服务器，这些方法也几乎没用到过。今天从JavaScript红皮书中读了下Ajax部分，发现并没有想象中的那么难。今天发文当作读书笔记。</p>

<h3 id="ajax简介">Ajax简介</h3>

<p>Ajax技术的核心是XMLHttpRequest对象(简称XHR)。IE5是最先引入XHR对象的浏览器，这个对象的实现从IE5、IE5.5、IE6经历过3个版本。要生成兼容的XHR对象，需要建立一个通用函数：</p>

<pre class="prettyprint prettyprinted" style=""><code class="language-javascript"><span class="kwd">function</span><span class="pln"> getXHR</span><span class="pun">(){</span><span class="pln">
  </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln"> arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeX</span><span class="pun">){</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'MSXML2.XMLHttp'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'MSXML2.XMLHttp.3.0'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'MSXML2.XMLHttp.6.0'</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> options</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> len</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">++){</span><span class="pln">
      </span><span class="kwd">try</span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ActiveXObject</span><span class="pun">(</span><span class="pln">options</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
        arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeX </span><span class="pun">=</span><span class="pln"> options</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">
      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ActiveXObject</span><span class="pun">(</span><span class="pln"> arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeX </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>当IE发布到IE7之前，现代浏览器所支持的XHR标准对象才得以形成。于是在IE7+的浏览器都支持标准XHR。</p>

<pre class="prettyprint prettyprinted" style=""><code class="language-javascript"><span class="kwd">var</span><span class="pln"> xhr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">()</span></code></pre>

<p>将两个方式合并起来将是：</p>

<pre class="prettyprint prettyprinted" style=""><code class="language-javascript"><span class="kwd">function</span><span class="pln"> getXHR</span><span class="pun">(){</span><span class="pln">
  </span><span class="kwd">if</span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="str">'undefined'</span><span class="pun">){</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> </span><span class="typ">ActiveXObject</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="str">'undefined'</span><span class="pun">){</span><span class="pln">
    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeXString </span><span class="pun">!==</span><span class="pln"> </span><span class="str">'string'</span><span class="pun">){</span><span class="pln">
      </span><span class="kwd">var</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'MSXML2.XMLHttp.6.0'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'MSXML2.XMLHttp.3.0'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'MSXML2.XMLHttp'</span><span class="pun">]</span><span class="pln">
      </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> len </span><span class="pun">=</span><span class="pln"> options</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> len</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">++){</span><span class="pln">
        </span><span class="kwd">try</span><span class="pun">{</span><span class="pln">
          </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ActiveXObject</span><span class="pun">(</span><span class="pln">options</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln">
          arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeXString </span><span class="pun">=</span><span class="pln"> options</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln">
          </span><span class="kwd">break</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ActiveXObject</span><span class="pun">(</span><span class="pln">arguments</span><span class="pun">.</span><span class="pln">callee</span><span class="pun">.</span><span class="pln">activeXString</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">(</span><span class="str">'no xhr available.'</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p>现在就可以在所有浏览器里使用XHR对象了。</p>

<pre class="prettyprint prettyprinted" style=""><code class="language-javascript"><span class="kwd">var</span><span class="pln"> xhr </span><span class="pun">=</span><span class="pln"> getXHR</span><span class="pun">()</span></code></pre>

<h3 id="xhr的使用">XHR的使用</h3>



  </div>
</div>
<footer>
  <div class="container">
    <p>&copy; Stenders.github.io@2014</p>
  </div>
</footer>
<a href="javascript:;" class="gotop"><i class="fa fa-arrow-circle-o-up"></i></a>
<!-- <script type="text/javascript" src="/js/jquery-1.10.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script> -->
<script type="text/javascript" src="/js/posts.js"></script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F062a4b4393b5b26e1db637b7504e8737' type='text/javascript'%3E%3C/script%3E"));
</script>
</body>
</html>